
% Dragon or Bunny or Sphere
material = 'Sphere';

magnification = 3;

load(strcat('../img/xyz/xyz',material,'SD.mat'));
load(strcat('../img/xyz/xyz',material,'D.mat'));
load(strcat('../img/xyz/xyz',material,'S.mat'));
load('mat/monitorColorMax.mat');
load('mat/logScale.mat');


SDsame = colorizeXYZ(xyzSD);
SDdifferent = colorizeXYZ(xyzD) + wTxyzS;
aveBrightness = zeros(1,9);
figure;
montage(xyz2rgb(SDsame)/16, 'size', [3 3]);
figure;
montage(xyz2rgb(SDdifferent)/16, 'size', [3 3]);

ss = strcat('../img/mag',num2str(magnification),'/SDsame',material,'.mat');
sd = strcat('../img/mag',num2str(magnification),'/SDdifferent',material,'.mat');
save(ss,'SDsame');
save(sd,'SDdifferent');

function coloredXyzData = colorizeXYZ(xyzMaterial)
    cx2u = makecform('xyz2upvpl');
    cu2x = makecform('upvpl2xyz');
    upvplMaterial = applycform(xyzMaterial,cx2u);
    coloredXyzData(:,:,:,1) = xyzMaterial;
    [iy,ix,iz] = size(xyzMaterial);
    load('mat/monitorColorMax.mat');
 
   
    for i = 1:8
        upvpl = upvplMaterial;
        for j = 1:iy
            for k = 1:ix
                for l = 1:size(monitorColorMax,1)-1
                    if upvpl(j,k,3) > monitorColorMax(l,3,1) && upvplMaterial(j,k,3) < monitorColorMax(l+1,3,1)
                        upvpl(j,k,1) = monitorColorMax(l,1,i);
                        upvpl(j,k,2) = monitorColorMax(l,2,i);
                    end
                end
            end
        end
        disp(i);
        coloredXyzData(:,:,:,i+1) = applycform(upvpl,cu2x);
    end
end
